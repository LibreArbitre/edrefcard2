{% extends "base.html" %}

{% block title %}EDRefCard - Elite: Dangerous Reference Card Generator{% endblock %}

{% block content %}
<div id="container">
    <div id="banner">
        <h1>EDRefCard</h1>
        <p class="text-muted">Generate printable reference cards for your Elite: Dangerous bindings</p>
    </div>

    <div id="content">
        <!-- Navigation Links -->
        <div class="nav-links">
            <a href="{{ url_for('list_configs') }}" class="nav-link">View published bindings</a>
            <a href="{{ url_for('list_devices') }}" class="nav-link">Supported devices</a>
        </div>

        <form id="uploadbindings" enctype="multipart/form-data" method="post" action="{{ url_for('generate') }}"
            accept-charset="utf-8">

            <!-- File Upload Section -->
            <div class="form-section">
                <h3>ğŸ“‚ Choose a bindings file</h3>
                <p>Your custom bindings files reside as <code>.binds</code> files in your local data directory:</p>
                <p class="text-muted" style="font-size: 0.9rem;">
                    <code>%LOCALAPPDATA%\Frontier Developments\Elite Dangerous\Options\Bindings</code>
                </p>

                <div class="file-upload-wrapper">
                    <label for="fileupload" class="file-upload" id="dropZone">
                        <div class="file-upload-icon">ğŸ“</div>
                        <div class="file-upload-text">
                            <strong>Click to select a file</strong><br>
                            or drag and drop your .binds file here
                        </div>
                    </label>
                    <input id="fileupload" name="bindings" type="file" accept=".binds" required>
                </div>
            </div>

            <!-- Filtering Section -->
            <div class="form-section">
                <h3>ğŸ® Control Categories</h3>
                <p>Select which categories to include on your reference card:</p>

                <div class="checkbox-grid">
                    <label class="checkbox-item">
                        <input type="checkbox" checked name="showship" value="on">
                        <span>ğŸš€ Ship</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked name="showsrv" value="on">
                        <span>ğŸš— SRV</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked name="showscanners" value="on">
                        <span>ğŸ“¡ Scanners</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked name="showfighter" value="on">
                        <span>âœˆï¸ Fighter</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked name="showonfoot" value="on">
                        <span>ğŸš¶ On Foot</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked name="showmulticrew" value="on">
                        <span>ğŸ‘¥ Multicrew</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked name="showheadlook" value="on">
                        <span>ğŸ‘€ Head Look</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked name="showui" value="on">
                        <span>ğŸ“± UI</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked name="showgalaxymap" value="on">
                        <span>ğŸ—ºï¸ Galaxy Map</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked name="showcamera" value="on">
                        <span>ğŸ“· Camera</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked name="showcommandercreator" value="on">
                        <span>ğŸ‘¤ Holo-Me</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" checked name="showmisc" value="on">
                        <span>âš™ï¸ Misc</span>
                    </label>
                </div>
            </div>

            <!-- Color Options Section -->
            <div class="form-section">
                <h3>ğŸ¨ Color Scheme</h3>
                <p>Choose how to highlight your controls:</p>

                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" checked name="styling" value="modifier">
                        <span>Color by Modifier</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="styling" value="group">
                        <span>Color by Type</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="styling" value="none">
                        <span>No Colors</span>
                    </label>
                </div>
            </div>

            <!-- Publishing Section -->
            <div class="form-section">
                <h3>ğŸ“¤ Publish (Optional)</h3>
                <p>Add a description to share your bindings publicly:</p>

                <input type="text" name="description" placeholder="e.g., My HOTAS setup for combat..." maxlength="190">

                <p class="text-muted mt-1" style="font-size: 0.85rem;">
                    Descriptions are curated. Offensive or spammy content will be removed.
                </p>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn-primary">
                ğŸš€ Generate Reference Card
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Drag and drop enhancement
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileupload');

    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
        });
    });

    dropZone.addEventListener('drop', (e) => {
        const files = e.dataTransfer.files;
        if (files.length) {
            fileInput.files = files;
            updateFileLabel(files[0].name);
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length) {
            updateFileLabel(e.target.files[0].name);
        }
    });

    function updateFileLabel(filename) {
        dropZone.querySelector('.file-upload-text').innerHTML =
            '<strong>Selected:</strong> ' + filename;
    }
</script>
{% endblock %}